<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Basic -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>EPX Labs, Inc.</title>
    <meta name="keywords" content="" />
    <meta name="description" content="EPX Labs, Inc." />
    <meta name="author" content="EPX Labs, Inc." />
    <meta name="google-site-verification" content="Rs32ezHC25vADQquLA_bBGGylM54r7kuHg2DmMJ8hhg" />
    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/1cefb549bc4e/epx-favicon.png" type="image/x-icon" />
    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- Web Fonts  -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800%7CShadows+Into+Light" rel="stylesheet" type="text/css" />
    <!-- CSS Bundle -->
    <link rel="stylesheet" type="text/css" href="/bundles/d23dee499b3c/app.css" />
    <!-- Head Libs -->
    <script src="/vendor/modernizr/modernizr.min.js"></script>
  </head>
  <body class="one-page" data-target="#header" data-spy="scroll" data-offset="100">
    <div class="body">
      <!-- Fill content here -->
      <div role="main" class="main" id="home"><html><body><div id="intro">
  <header id="header" class="header-narrow" data-plugin-options="{&quot;stickyEnabled&quot;: true, &quot;stickyEnableOnBoxed&quot;: true, &quot;stickyEnableOnMobile&quot;: true, &quot;stickyStartAtElement&quot;: &quot;#header&quot;, &quot;stickySetTop&quot;: &quot;0&quot;, &quot;stickyChangeLogo&quot;: false}">
    <div class="header-body">
      <div class="header-container container">
        <div class="header-row">
          <div class="header-column">
            <div class="header-logo">
              <a href="/" id="header-logo">
                <img alt="EPX Labs" width="205" height="50" data-sticky-width="164" data-sticky-height="40" data-sticky-top="7" src="/img/logos/62b1cdcca819/epx_logo.svg" />
              </a>
            </div>
          </div>
          <div class="header-column">
            <div class="header-row">
              <div class="header-nav header-nav-top-line">
                <button class="btn header-btn-collapse-nav" data-toggle="collapse" data-target=".header-nav-main">
                  <i class="fa fa-bars"></i>
                </button>
                <ul class="header-social-icons social-icons hidden-xs">
                  <li class="social-icons-github"><a target="_blank" href="https://github.com/epxlabs/" title="GitHub"><i class="fa fa-github"></i></a></li><li class="social-icons-linkedin"><a target="_blank" href="https://www.linkedin.com/company/epx-labs/" title="LinkedIn"><i class="fa fa-linkedin"></i></a></li><li class="social-icons-twitter"><a target="_blank" href="https://twitter.com/epxlabs" title="Twitter"><i class="fa fa-twitter"></i></a></li>
                </ul>
                <div class="header-nav-main header-nav-main-square header-nav-main-effect-3 header-nav-main-sub-effect-1 collapse">
                  <nav>
                    <ul class="nav nav-pills" id="mainNav">
                      <li id="devops">
                        <a data-hash="data-hash" data-hash-offset="70" href="devops" class="nav-links">Devops</a>
                      </li><li id="serverless">
                        <a data-hash="data-hash" data-hash-offset="70" href="serverless" class="nav-links">Serverless</a>
                      </li><li id="nodejs">
                        <a data-hash="data-hash" data-hash-offset="70" href="nodejs" class="nav-links">nodejs</a>
                      </li><li id="clojure">
                        <a data-hash="data-hash" data-hash-offset="70" href="clojure" class="nav-links">Clojure</a>
                      </li><li id="who-we-are">
                        <a data-hash="data-hash" data-hash-offset="70" href="who-we-are" class="nav-links">Who We Are</a>
                      </li><li id="blog" class="dropdown active">
                        <a data-hash="data-hash" data-hash-offset="70" href="blog" class="nav-links">Blog</a>
                      </li><li id="join-us!">
                        <a data-hash="data-hash" data-hash-offset="70" href="careers" class="nav-links">Join Us!</a>
                      </li><li id="contact-us">
                        <a data-hash="data-hash" data-hash-offset="70" href="#contact" class="nav-links">Contact Us</a>
                      </li>
                    </ul>
                  </nav>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>
</div>
<!-- END HEADER -->
</body></html><html><body><div class="row"><div class="blog-post">
  <h2></h2>
  <div class="col-md-8 col-md-offset-2"><div class="post-body"><h1>Magento: quickly set-up autoscaling Magento on AWS with a Prodution and Dev environment</h1>
<table>
  <tr>
    <td>
      <img style="display:block;" width="100%" src="https://s3.amazonaws.com/blog-images.epxlabs.com/fast-setup-magento-in-aws/1.png" />
    </td>
    <td>
      <img style="display:block;" width="100%" src="https://s3.amazonaws.com/blog-images.epxlabs.com/fast-setup-magento-in-aws/2.png" />
    </td>
  </tr>
</table><p>We have open-sourced the following <a href="https://github.com/epxlabs/magento-in-aws">cloudformation templates</a> so you can effortlessly deploy the environments illustrated above. <br /> Figure 1 is a standard out-of-the-box autoscaling production setup. The MySQL database is provisioned on RDS and leverages cross availability zone replication. <br /> Figure 2 is better suited for a development environment to save costs on infrastructure. You may turn off instances when they are not required.</p><p>This work is meant to enhance the current Quick Start guide found here: <a href="http://docs.aws.amazon.com/quickstart/latest/magento/welcome.html">Magento on the AWS Cloud: Quick Start Reference Deployment</a></p><p>We have reworked the guides Cloudformation templates and corrected some flaws.</p>
<hr /><h3>The AWS Quickstart Guide, Before our Enhancements:</h3>
<ul>
  <li>Over-provisioned resources: depending on the region, the quick start setup will create 2 or 3 availability zones with an EC2 NAT in each. If your setup is small these are unnecessary costs.</li>
  <li>Incorrectly configured Load-balancer: only two zones are included in the load balancing even when a third is provisioned.</li>
  <li>We prefer not to use EC2 NATs, we like to simplify our infrastructure management. The Quick-start guide uses EC2s.</li>
  <li>The sample development environment that we diagrammed is not included, only the RDS based option exists.</li>
</ul>
<hr /><h3>After our enhancements you now have the following improvements:</h3>
<ul>
  <li>Choose your own # of availability zoens: now you can select the exact number of availablity zones (up to 5) for setup. If there are less AZs in your region than what you would like to provision the maximum number allowed will be setup.</li>
  <li>Load balancing correcting: all your provisioned AZs will be included in load balancing.</li>
  <li>Less Management: the EC2 NATs have been replaced by NAT Gateways and we have added a Bastion (as the entry point).</li>
  <li>Cheaper Development environment option available. (We typically suggest that production and staging/dev are mimic's of one another so you can properly test infrastructure level changes in staging, however, this might be cost prohibitive for your organization. So, we've included a cheaper single EC2 option that can be turned off when not in use.)</li>
</ul>
<hr /><h2>How to use our templates:</h2>
<ul>
  <li>Clone the repository from our github account:</li>
</ul>
<pre class="codehilite"><div class="hll"><pre class="codehilite"><span class="nv">git</span> <span class="nv">clone</span> <span class="nv">git</span><span class="o">@</span><span class="nv">github.com</span><span class="ss">:epxlabs/magento-in-aws.git</span>
<span class="nv">cd</span> <span class="nv">magento-in-aws</span>
</pre></div>
</pre><h3>We suggest placing the cloudformation templates into S3 on your AWS account:</h3><p><strong>STEP 1.</strong> Download Magento 1.9.x and Magento Sample Data - 1.x in <code>tar.gz</code> format (you will probably need to register at <a href="https://magento.com/">https://magento.com/</a>) </p><p><strong>STEP 2.</strong> Create an s3 bucket for your Magento sample data.</p>
<pre class="codehilite"><div class="hll"><pre class="codehilite"><span class="nv">aws</span> <span class="nv">s3</span> <span class="nv">mb</span> <span class="nv">s3</span><span class="ss">://&lt;mybucket&gt;</span> <span class="nv">--region</span> <span class="nv">&lt;region_if_needed&gt;</span>
<span class="o">#</span> <span class="nv">eg.aws</span> <span class="nv">s3</span> <span class="nv">mb</span> <span class="nv">s3</span><span class="ss">://epxlabs-magento-data</span> <span class="nv">--region</span> <span class="nv">us-west-2</span>
</pre></div>
</pre><p><strong>STEP 3.</strong> Upload a.k.a. <code>sync</code> the Magento and Magento Sample Data to your s3 bucket:</p>
<pre class="codehilite"><div class="hll"><pre class="codehilite"><span class="nv">aws</span> <span class="nv">s3</span> <span class="nb">sync </span><span class="k">. </span><span class="nv">s3</span><span class="ss">://epxlabs-magento-data</span> <span class="nv">--exclude</span> <span class="ss">'.git/*</span><span class="o">'</span> <span class="nv">--acl</span> <span class="nv">public-read</span> <span class="nv">--delete</span> <span class="nv">--region</span> <span class="nv">us-west-2</span>
</pre></div>
</pre><p><strong>STEP 4.</strong> Create an s3 bucket for the templates:</p>
<pre class="codehilite"><div class="hll"><pre class="codehilite"><span class="nv">aws</span> <span class="nv">s3</span> <span class="nv">mb</span> <span class="nv">s3</span><span class="ss">://&lt;mybucket&gt;</span> <span class="nv">--region</span> <span class="nv">&lt;region_if_needed&gt;</span>
<span class="o">#</span> <span class="nv">eg.aws</span> <span class="nv">s3</span> <span class="nv">mb</span> <span class="nv">s3</span><span class="ss">://epxlabs-magento-templates</span> <span class="nv">--region</span> <span class="nv">us-west-2</span>
</pre></div>
</pre><p><strong>STEP 5.</strong> Change default value for <code>TemplatesBucket</code> parameter in the <code>master.template</code> file from the epxlabs/magento-in-aws repo, or, override it when you deploy the new stack.</p>
<pre class="codehilite"><div class="hll"><pre class="codehilite">  <span class="s">"Parameters"</span> <span class="err">:</span> <span class="p">{</span>
    <span class="s">"TemplatesBucket"</span> <span class="err">:</span> <span class="p">{</span>
      <span class="s">"Type"</span> <span class="err">:</span> <span class="s">"String"</span>,
      <span class="s">"Default"</span> <span class="err">:</span> <span class="s">"https://s3-{*INSERT BUCKET REGION*}.amazonaws.com/{*INSERT BUCKET NAME*}"</span>,
      <span class="s">"Description"</span> <span class="err">:</span> <span class="s">"Path to bucket with templates for setup"</span>,
      <span class="s">"ConstraintDescription"</span> <span class="err">:</span> <span class="s">"must be valid path to bucket with templates. Ex. https://s3-us-west-2.amazonaws.com/epxlabs-magento-templates"</span>
    <span class="p">}</span>,
</pre></div>
</pre><p><strong>STEP 6.</strong> Change default values for the <code>MagentoReleaseMedia</code> and <code>MagentoSampleData</code> parameters in the <code>master.template</code> or override them when you deploy new stack.</p>
<pre class="codehilite"><div class="hll"><pre class="codehilite">    <span class="s">"MagentoReleaseMedia"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s">"Description"</span><span class="err">:</span> <span class="s">"Amazon S3 path to download magento .tar.gz file (s3://mybucket/magento-1.9.2.2.tar.gz)"</span>,
      <span class="s">"Default"</span><span class="err">:</span> <span class="s">"s3://{*INSERT S3 BUCKET NAME HERE*}/magento-1.9.3.0-2016-10-11-06-05-14.tar.gz"</span>,
      <span class="s">"Type"</span><span class="err">:</span> <span class="s">"String"</span>
    <span class="p">}</span>,
    <span class="s">"MagentoSampleData"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s">"Description"</span><span class="err">:</span> <span class="s">"[ optional ] Amazon S3 path to download magento sample data file ((s3://mybucket/magento-sample-data.tar.gz)"</span>,
      <span class="s">"Default"</span><span class="err">:</span> <span class="s">"s3://{*INSERT S3 BUCKET NAME HERE*}/magento-sample-data-1.9.2.4-2016-10-11-07-38-13.tar.gz"</span>,
      <span class="s">"Type"</span><span class="err">:</span> <span class="s">"String"</span>
    <span class="p">}</span>,
</pre></div>
</pre><p><strong>STEP 7.</strong> Upload a.k.a. <code>sync</code> the templates into your new s3 bucket</p>
<pre class="codehilite"><div class="hll"><pre class="codehilite"><span class="nv">aws</span> <span class="nv">s3</span> <span class="nb">sync </span><span class="k">. </span><span class="nv">s3</span><span class="ss">://epxlabs-magento-templates</span> <span class="nv">--exclude</span> <span class="ss">'.git/*</span><span class="o">'</span> <span class="nv">--acl</span> <span class="nv">public-read</span> <span class="nv">--delete</span> <span class="nv">--region</span> <span class="nv">us-west-2</span>
</pre></div>
</pre><p><strong>STEP 8.</strong> Create a new stack using Cloudformation in the AWS Console or using the AWS CLI.</p><p><strong>STEP 9.</strong> Any questions, issues, errors, or propositions please contact <a href="mailto:hello@epxlabs.com">hello@epxlabs.com</a></p><h3>Hint: How to figure out the real count of Availability Zones in regions</h3>
<pre class="codehilite"><div class="hll"><pre class="codehilite"><span class="nv">$</span> <span class="nb">for </span><span class="nv">i</span> <span class="nv">in</span> <span class="nv">$</span><span class="p">(</span><span class="nf">aws</span> <span class="nv">ec2</span> <span class="nv">describe-regions</span><span class="err">|</span><span class="nv">grep</span> <span class="nv">RegionName</span><span class="err">|</span><span class="nv">awk</span> <span class="o">'</span><span class="p">{</span><span class="nb">print </span><span class="nv">$2</span><span class="p">}</span><span class="o">'</span><span class="err">|</span> <span class="nv">tr</span> <span class="nv">-d</span> <span class="sc">\"</span><span class="p">)</span><span class="c1">; do echo Region $i contains; aws ec2 describe-availability-zones --region $i|grep ZoneName; done</span>
<span class="nv">...</span>
<span class="nv">Region</span> <span class="nv">us-east-1</span> <span class="nv">contains</span>
            <span class="s">"ZoneName"</span><span class="err">:</span> <span class="s">"us-east-1a"</span>
            <span class="s">"ZoneName"</span><span class="err">:</span> <span class="s">"us-east-1c"</span>
            <span class="s">"ZoneName"</span><span class="err">:</span> <span class="s">"us-east-1d"</span>
            <span class="s">"ZoneName"</span><span class="err">:</span> <span class="s">"us-east-1e"</span>
<span class="nv">Region</span> <span class="nv">us-west-1</span> <span class="nv">contains</span>
            <span class="s">"ZoneName"</span><span class="err">:</span> <span class="s">"us-west-1a"</span>
            <span class="s">"ZoneName"</span><span class="err">:</span> <span class="s">"us-west-1b"</span>
<span class="nv">...</span>
</pre></div>
</pre><div id="disqus_thread"></div></div></div>
</div></div>
</body></html><section id="contact" class="section section-no-border mb-none bottom">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <div class="alert alert-success hidden" id="contactSuccess">
          <strong>Success!</strong> We have received your message.
        </div>
        <div class="alert alert-danger hidden" id="contactError">
          <strong>Oops!</strong> An error occured and your message could not be sent. Please email us at <strong>hello@epxlabs.com</strong> or call us at <strong>+1 (646)-768-0123</strong>
        </div>
        <h2 class="mb-sm mt-sm"><strong>Contact</strong> Us</h2>
        <form id="contactForm" action="" method="POST">
          <div class="row">
            <div class="form-group">
              <div class="col-md-6">
                <label>Your name</label>
                <input type="text" value="" data-msg-required="Please enter your name." maxlength="100" class="form-control" name="name" id="name" required="required" />
              </div>
              <div class="col-md-6">
                <label>Your email address</label>
                <input type="email" value="" data-msg-required="Please enter your email address." data-msg-email="Please enter a valid email address." maxlength="100" class="form-control" name="email" id="email" required="required" />
              </div>
            </div>
          </div>
          <div class="row">
            <div class="form-group">
              <div class="col-md-12">
                <label>Message</label>
                <textarea maxlength="5000" data-msg-required="Please enter your message." rows="6" class="form-control" name="message" id="message" required="required"></textarea>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <input type="submit" value="Submit" class="btn btn-primary btn-lg mb-xlg" data-loading-text="Loading..." />
            </div>
          </div>
        </form>
      </div>
      <div class="col-md-6">
        <h4 class="heading-primary mt-lg">Get in <strong>Touch</strong></h4>
        <p id="get-in-touch">We are always available to help solve your business problems, meet others in the serverless space, and discuss what we're passionate about. You can get in touch with us here :-)</p>
        <hr />
        <ul id="contact-info" class="list list-icons list-icons-style-3 mt-xlg">
          <li><i class="fa fa-phone"></i> <strong>Phone:</strong> 646.768.0123</li>
          <li><i class="fa fa-envelope"></i> <strong>Email:</strong><a href="mailto:hello@epxlabs.com"> hello@epxlabs.com</a></li>
        </ul>
        <hr />
        <h4 class="heading-primary">Follow <strong>Us</strong></h4>
        <ul class="social-icons">
          <li class="social-icons-github"><a target="_blank" href="https://github.com/epxlabs/" title="GitHub"><i class="fa fa-github"></i></a></li><li class="social-icons-linkedin"><a target="_blank" href="https://www.linkedin.com/company/epx-labs/" title="LinkedIn"><i class="fa fa-linkedin"></i></a></li><li class="social-icons-twitter"><a target="_blank" href="https://twitter.com/epxlabs" title="Twitter"><i class="fa fa-twitter"></i></a></li>
        </ul>
      </div>
    </div>
  </div>

<!-- END CONTACT US -->
</section><footer id="footer" class="color color-secondary">
  <div class="footer-copyright">
    <div class="container">
      <div class="row">
        <div class="col-xs-6 col-xs-offset-3 col-md-2 col-md-offset-5">
          <a href="index.html" class="logo">
            <img alt="EPX Labs" class="img-responsive" src="/img/logos/62b1cdcca819/epx_logo.svg" />
          </a>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4 text-center col-md-offset-4" id="copyright">
          <p>© Copyright 2017 EPX Labs, Inc. All Rights Reserved.</p>
        </div>
      </div>
    </div>
  </div>
</footer></div>
    </div>
    <!-- JS Bundle -->
    <script src="/bundles/e5a487604c0d/app.js"></script>
    <script id="dsq-count-scr" src="//www-epxlabs-com.disqus.com/count.js" async="async"></script>
    <!-- Google Analytics Script -->
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-85354348-2', 'auto');
  ga('send', 'pageview');</script>
  </body>

</html>